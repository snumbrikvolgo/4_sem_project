#include "enemy.h"
#include "map.h"
#include <iostream>

Enemy::Enemy(Image &image, float X, float Y,int W,int H,String Name):Entity(image,X,Y,W,H,Name){
if (name == "EasyEnemy"){
sprite.setTextureRect(IntRect(0, 0, w, h));
dx = 0.1;//даем скорость.этот объект всегда двигается

std::cout << "Enemy created" << " " << x << " " << " " << y << " " << " "<< w << h  << std::endl;
}
}

void Enemy::checkCollisionWithMap(float Dx, float Dy)//ф ция проверки столкновений с картой
{
    for (int i = y / 32; i < (y + h) / 32; i++)//проходимся по элементам карты
        for (int j = x / 32; j<(x + w) / 32; j++)
        {
            if (TileMap[i][j] == '0')//если элемент наш тайлик земли, то
            {
                if (Dy>0){ y = i * 32 - h; }//по Y вниз=>идем в пол(стоим на месте) или падаем. В этот момент надо вытолкнуть персонажа и поставить его на землю, при этом говорим что мы на земле тем самым снова можем прыгать
                if (Dy<0){ y = i * 32 + 32; }//столкновение с верхними краями карты(может и не пригодиться)
                if (Dx>0){ x = j * 32 - w; dx = -0.1; sprite.scale(-1, 1); }//с правым краем карты
                if (Dx<0){ x = j * 32 + 32; dx = 0.1; sprite.scale(-1, 1); }// с левым краем карты
            }
        }
}

void Enemy::update(float time)
{
    if (name == "EasyEnemy"){//для персонажа с таким именем логика будет такой
        //moveTimer += time;if (moveTimer>3000){ dx *= -1; moveTimer = 0; }//меняет направление примерно каждые 3 сек
        checkCollisionWithMap(dx, 0);//обрабатываем столкновение по Х
        x += dx*time;
        sprite.setPosition(x + w / 2, y + h / 2); //задаем позицию спрайта в место его центра
        //std::cout << "position" << "x+w/2" << x+w/2 << std::endl;
        if (health <= 0){ life = false; }
    }
}